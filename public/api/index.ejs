var _Unippear;


function Unippear(opts) {
  _Unippear = opts || {};
  _Unippear.headerFooterContainer = _Unippear.headerFooterContainer || 'body';
  _Unippear.headerHtmlFragment = '<%-currHost%>/header.html';
  _Unippear.footerHtmlFragment = '<%-currHost%>/footer.html';

  <% include jquery.js %>
    $jQ = $.noConflict(true);
  $jQ(function() {
    // download css
    <% cssFiles.forEach(function(f) { %>
      $jQ('head').append('<link rel="stylesheet" href="<%=f%>"/>'); <%
    }); %>

    $jQ.ajaxSetup({
      cache: true
    });
    // download js
    <%
    if (locals.jsFiles) {
      jsFiles.forEach(function(f) { %>
        $jQ.getScript("<%=currHost%>/js/<%=f%>").done(function() { <%
        }); %>
        // download header and footer after js are loaded
        $jQ.get(opts.headerHtmlFragment, function(data) {
          try {
            $jQ(_Unippear.headerFooterContainer).first().prepend(data);
          }
          catch (err) {}
          try {
            // don't used embedded $jQ, use the "default" one instead. Otherwise
            // the handlers won't be called.
            $(document).trigger('headerLoaded');
          }
          catch (err) {}
        });
        $jQ.get(opts.footerHtmlFragment, function(data) {
          try {
            $jQ(_Unippear.headerFooterContainer).first().append(data);
          }
          catch (err) {}
          try {
            $(document).trigger('footerLoaded');
          }
          catch (err) {}
        }); <% jsFiles.forEach(function(f) { %>
        }); <%
      });
    }
    else { %>
      $jQ.getScript("<%=currHost%>/combined.js").done(function() {
        // download header and footer after js are loaded
        $jQ.get(opts.headerHtmlFragment, function(data) {
          try {
            $jQ(_Unippear.headerFooterContainer).first().prepend(data);
          }
          catch (err) {}
          try {
            $(document).trigger('headerLoaded');
          }
          catch (err) {}
        });
        $jQ.get(opts.footerHtmlFragment, function(data) {
          try {
            $jQ(_Unippear.headerFooterContainer).first().append(data);
          }
          catch (err) {}
          try {
            $(document).trigger('footerLoaded');
          }
          catch (err) {}
        });
      }); <%
    } %>
  });
};